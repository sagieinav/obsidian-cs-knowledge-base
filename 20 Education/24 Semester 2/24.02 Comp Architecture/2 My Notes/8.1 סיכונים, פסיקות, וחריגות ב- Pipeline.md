```table-of-contents
```
## 1. 锔 住 转 (Data Hazards) - (驻砖 8)

### 1.1 专 

###### 注: RAW (Read After Write)
*   **专**: 住 转 转专砖 砖专 驻拽 -Pipeline 住 砖转砖 转爪 砖 驻拽 拽转, 砖注  住 转 爪注  转 转 转爪 专 注 (专, 拽抓 专住专).
*   **住 注拽专 (RAW)**: 驻拽 住 **拽专** (Read) 专住专 **专** (After) 砖驻拽 拽转 专 **转** (Write) ,  转 专 爪注.
*   ****:
    ```mips
    sub $2, $1, $3   # 转 -$2 砖 WB (专 5)
    and $12, $2, $5  # 拽专 转 $2 砖 ID (专 3) - HAZARD!
    or $13, $6, $2   # 拽专 转 $2 砖 ID (专 4) - HAZARD!
    add $14, $2, $2  # 拽专 转 $2 砖 ID (专 5) -  Hazard (爪 专)
    ```
    爪 , 驻拽转 `and` -`or` 拽专 注专 砖  注 砖 `$2`   驻 住.

```mermaid
graph TD
    subgraph Clock_Cycles
        direction LR
        CC1 --> CC2 --> CC3 --> CC4 --> CC5 --> CC6 --> CC7;
    end
    subgraph SUB_Instruction
        SUB_IF[IF sub $2] --> SUB_ID[ID] --> SUB_EX[EX Result -20] --> SUB_MEM[MEM] --> SUB_WB[WB Write $2];
    end
    subgraph AND_Instruction
        AND_IF[IF and $12,$2] --> AND_ID[ID Needs $2<br>Reads old val 10] --> AND_EX[EX uses 10];
        AND_EX --> AND_MEM[MEM];
        AND_MEM --> AND_WB[WB];
    end
    subgraph OR_Instruction
        OR_IF[IF or $13,$6,$2] --> OR_ID[ID Needs $2<br>Reads old val 10] --> OR_EX[EX uses 10];
        OR_EX --> OR_MEM[MEM];
        OR_MEM --> OR_WB[WB];
    end

    CC1 --> SUB_IF;
    CC2 --> SUB_ID; CC2 --> AND_IF;
    CC3 --> SUB_EX; CC3 --> AND_ID; CC3 --> OR_IF;
    CC4 --> SUB_MEM; CC4 --> AND_EX; CC4 --> OR_ID;
    CC5 --> SUB_WB; CC5 --> AND_MEM; CC5 --> OR_EX;
    CC6 --> AND_WB; CC6 --> OR_MEM;
    CC7 --> OR_WB;

    classDef hazard fill:#f99;
    class AND_ID, OR_ID hazard;

```
*(转 -Hazard )*

### 1.2 驻转专 1: 住驻转 NOPs (Stalling / Bubbles)
*   住转 驻拽转 `nop` (砖 注砖转 ) 专 驻拽 转转,  注 转 驻拽 拽专转 注 砖转 转 -Register File   拽专.
*    注, 专砖 2 `nop`s 专 -`sub`  砖驻拽转 `and` 转拽专 转 注专 .
*   **住专**:  专 砖注 ( CPI), 驻注 爪注.

### 1.3 驻转专 2: Forwarding / Bypassing (注专 拽 / 注拽驻)
*   **专注**: 转爪 -ALU (住祝 砖 EX)  专 (住祝 砖 MEM)  **拽 转专** 砖 转转 -Register File (砖 WB). 转 注专 转 **砖专转** 专 拽 住驻 (Bypass paths) 住转 -ALU (转转 砖 EX) 砖 驻拽  砖拽拽 .
*   **砖 专转**:
    *   **Forwarding Unit**:  转 拽专转 砖 转转 RAW  驻拽转 砖 EX, MEM, WB  驻拽 砖 ID/EX.
    *   **转  (, ForwardA 注专 拽 Rs)**:
        1.  **EX Hazard**:  驻拽 -EX/MEM 转转 专住专 (`RegWrite=1`), 专住专   `$0`,   -Rs 砖 驻拽 -ID/EX?
        2.  **MEM Hazard**:  驻拽 -MEM/WB 转转 专住专,   `$0`,  **  注 砖 驻拽转 -EX Hazard ( 转转 注驻转 注专 砖 转专 -EX),   -Rs 砖 驻拽 -ID/EX?
    *   **MUX 住转 -ALU**: 住驻 MUX 注 3 住转  拽 砖 -ALU:
        *   00: 拽 -Register File (专专转 ).
        *   01: 拽 转爪 专住专 MEM/WB (Forwarding -MEM).
        *   10: 拽 -ALUOut 专住专 EX/MEM (Forwarding -EX).
    *   -Forwarding Unit 砖转 -MUX  (`ForwardA`, `ForwardB`).

```mermaid
graph TD
    subgraph Pipeline_Registers
        ID_EX(ID/EX Reg);
        EX_MEM(EX/MEM Reg);
        MEM_WB(MEM/WB Reg);
    end

    subgraph Logic_Units
        RF(Register File);
        ALU(ALU);
    end

    ForwardUnit(Forwarding Unit);

    ID_EX -- RegRsAddr, RegRtAddr --> RF; # Read Addrs still go to RF
    RF -- ReadData1 --> MUX_A(MUX ForwardA);
    RF -- ReadData2 --> MUX_B(MUX ForwardB);

    MUX_A -- SelectedData1 --> ALU;
    MUX_B -- SelectedData2 --> ALU;

    EX_MEM -- ALUResult --> ForwardUnit;
    MEM_WB -- WB_Data --> ForwardUnit; # WB_Data can be ALURes or MemData

    EX_MEM -- DestRegAddr --> ForwardUnit;
    MEM_WB -- DestRegAddr --> ForwardUnit;
    ID_EX -- SourceRegAddrs --> ForwardUnit;

    ForwardUnit -- ForwardA_Sel --> MUX_A;
    ForwardUnit -- ForwardB_Sel --> MUX_B;

    EX_MEM -- ALUResult --> MUX_A;
    EX_MEM -- ALUResult --> MUX_B;
    MEM_WB -- WB_Data --> MUX_A;
    MEM_WB -- WB_Data --> MUX_B;

    classDef pipeReg fill:#f9f,stroke:#333;
    class ID_EX,EX_MEM,MEM_WB pipeReg;
    classDef logic fill:#eee,stroke:#333;
    class RF, ALU, ForwardUnit logic;

```
*(拽住驻 砖 Forwarding Unit -MUX 住 -ALU)*

> [!TIP] Forwarding Effectiveness
> Forwarding 驻转专 转 **专** 住 -RAW  爪专 -Stalls,  砖砖驻专 砖注转转 转 爪注 -Pipeline.

### 1.4 拽专 : Load-Use Hazard

###### 注
*   砖专 驻拽 ( `add`) 转 **** 转爪 砖 驻拽转 `lw` 拽转.
*   转 驻拽转 `lw`  **专拽 住祝 砖 MEM**.
*   Forwarding  注专 转 转  专拽 砖 **MEM** 砖 驻拽 ,  驻拽  爪专 转 专 砖 **EX**. Forwarding "专 "  驻砖专.

###### 驻转专: Stall  + Forwarding
*   **Hazard Detection Unit (HDU)**:  转 住驻转 砖 住驻爪驻转 转 爪 -Load-Use 砖 **ID**:
    *   **转 **:  驻拽 -ID/EX  `lw` (`MemRead=1`) ****  专住专 注 砖 (`rt` -ID/EX) 砖  专住专 拽专 (`rs`  `rt`) 砖 驻拽  (砖爪转 注转 -IF/ID)?
*   **驻注 注转 **:
    1.  **Stall**: 注转 转 驻拽 转 (砖-IF/ID) 转 转 驻拽 砖专 (注"  转 -PC -IF/ID).
    2.  **Bubble**: 住 "注" (NOP 专) 专住专 ID/EX (注" 驻住 转转 拽专).
*   **转爪**: 驻拽 转 转注转 专 . -`lw` 转拽 砖 MEM. 专 , 驻拽 转 注 砖 EX, -`lw` 注 砖 WB. 注转, Forwarding **砖 MEM 砖 -`lw`** (专 专住专 EX/MEM) 住转 -ALU **砖 驻拽 转 (砖 EX)** 驻砖专 注.

```mermaid
graph TD
    subgraph LW
        LW_IF[IF lw $t0] --> LW_ID[ID];
        LW_ID --> LW_EX[EX];
        LW_EX --> LW_MEM[MEM<br>$t0 Ready];
        LW_MEM --> LW_WB[WB];
    end
    subgraph ADD
        ADD_IF[IF add $t1,$t0] --> ADD_ID[ID Needs $t0];
        ADD_ID --> STALL[Stall];
        STALL --> ADD_EX[EX Uses $t0];
        ADD_EX --> ADD_MEM[MEM];
        ADD_MEM --> ADD_WB[WB];
    end

    LW_MEM -.->|Forwarding| ADD_EX;

    classDef hazard fill:#f99;
    class STALL hazard;
    linkStyle 2 stroke:#f00,stroke-width:2px;
```
*(专转 Load-Use Hazard 驻砖)*

> [!NOTE] MIPS History & Delayed Load
> 注 MIPS 拽,   砖 专转 -Stall -Load-Use Hazard (  Interlock).  转 住转 砖 "Microprocessor without Interlocked Pipeline Stages". 拽 转, 专转 转 注 专 住 `nop`  住专 砖 转 拽.  拽专 **Delayed Load**.

### 1.5 驻转专 转转: Instruction Reordering
*   专 (Compiler)  住转 砖转 转 住专 驻拽转   转 专拽  驻拽 转转 驻拽 转,   注 -Stall 砖 Load-Use.

---

## 2.  住 拽专 (Control Hazards) 驻住拽转 (驻砖 10)

### 2.1 住 拽专 (Branch Hazards)

###### 注
*   驻拽转 Branch (`beq`, `bne`) 砖转 转 -PC 专拽  转 转拽.
*    转转 注 砖 砖 专 -Pipeline (砖 驻砖, -EX; 砖 砖驻专, -ID).
*   注 , -Pipeline 专 住 驻拽转 砖专 -Branch ( 砖 拽驻爪).
*    -Branch  拽, 驻拽转 砖转 砖住 爪专转 转 (**Flush**).

###### 驻转专转

##### Stall (拽驻)
*   注爪专转 -Pipeline 专  -Branch 注 砖 注 注.
*   **住专**: 拽专 - Penalty 砖 住驻专 专 砖注 (转 砖 拽转 ).

##### 转 砖 -Branch 砖 ID
*   住驻转 专 砖 ID (Comparator, Adder) 驻砖专转 拽转  拽转 转专.
*   **转专**: 拽 转 -Penalty -**Stall **  (爪专  专拽 转 驻拽 砖 IF).
*   **住专**: 注 爪专 Data Hazards 砖  -Branch 转 转爪 砖 `lw` 拽.

##### Branch Prediction ()
*   **专注**: 砖 转 转爪转 -Branch 砖 爪注 住驻拽.  砖 砖, 爪注 Flush.
    *   **Predict Not Taken (住)**: 砖 砖-Branch  拽. 注 转 注 转 爪 住祝. -Penalty  专拽 砖专 -Branch 拽.
    *   **Predict Taken (住)**: 砖 砖-Branch 拽. 专砖 砖 注 拽, 注 注砖 专 -Stall.
*   **Dynamic Branch Prediction**: 专 转 转 转转 -Branches  专爪.
    *   **BHT (Branch History Table)**:  拽 转 驻 住专 专 砖 转 Branch (专 驻转转 驻 转转 -Branch).
        *   *1-Bit Predictor*: 专 专拽 转 驻注 专. 注 驻注 .
        *   *2-Bit Predictor*: FSM 注 4 爪 (Strongly/Weakly Taken/Not Taken). 专砖 2 注转 专爪驻转 砖  拽爪. 砖驻专 拽 砖注转转 (注 90%).
    *   **BTB (Branch Target Buffer)**: Cache 砖专  转 **转转 注** 砖 Branches 砖拽 注专. 驻砖专, 砖 注  Taken, 转 Fetch 注 **** 砖 IF,  驻爪转 注 转 -Penalty    .

##### Branch Delay Slot
*   **专 砖转 砖 ISA**: 驻拽 转转 `PC+4` (砖专 -Branch) 转爪注转 **转**.
*   **转驻拽 专**:  转 -"Slot"  驻拽 砖砖转 (砖 转 转爪转 -Branch)  -`nop`.
*   **转专**:  注 转 -Penalty ( 专 爪).
*   **住专**: 住 转 专, 砖祝 转 -Pipeline. ( 拽 -MIPS 拽住).

### 2.2 驻住拽转 专转 (Interrupts and Exceptions)

###### 专
*   专注  爪驻 砖 转 专转 拽专.
*   **Exception (专)**: 专注 **驻** 注 转爪 爪注 驻拽 (Arithmetic Overflow, Undefined Instruction, Page Fault, Syscall). 住专.
*   **Interrupt (驻住拽)**: 专注 **爪** 注 (拽砖转 I/O, Timer). -住专.

######  驻 -MIPS
1.  ****: 专  转 专注 砖 转 -Pipeline.
2.  **砖专转 注 (-Coprocessor 0)**:
    *   **`EPC (Exception PC)`**: 转转 驻拽 砖专 专 ( 驻拽 砖转 专 转爪注  拽专 砖 驻住拽).
    *   **`Cause Register`**: 拽 爪 转 住转 专注 (住 专/驻住拽).
3.  **注专转 拽专 -OS**: -PC 注 转转 拽注 专转 专砖 砖 **砖专转 驻 (Exception Handler)** 转 专 转转 砖 注专转 驻注 (Kernel).
4.  **爪注 -Handler (拽 OS)**:
    *   砖专 专住专 住驻 砖 转转 砖注爪专.
    *   拽 转 专住专 `Cause`  住.
    *   爪注 转 驻 专砖.
    *   砖专 专住专.
    *   专 转转 拽专转 (专 转转 砖专 -`EPC`) 爪注转 驻拽 转 ( `eret`).

###### 驻 -Pipeline

> [!IMPORTANT] Precise Exceptions
> -Pipeline   驻 "拽":  驻拽转 *驻* 驻拽 注转转 砖转 转 爪注,  驻拽转 *专* 转转 (Flush)   转 .

*   ****: 专转 转 转专砖 砖 砖 (Undefined Instruction -ID, Overflow -EX, Page Fault -IF/MEM).
*   **驻注**:
    1.  专  砖 转.
    2.  转转 转 (RegWrite, MemWrite) 注专 驻拽 注转转  驻拽转 砖专 -Pipeline  (驻 -0).
    3.  砖驻拽 注转转 注 砖 WB, 注 砖专 -EPC -Cause, -PC 注 转转 -Handler.
*   **驻住拽转 专转**:  住驻专 专转 转专砖转 驻拽转 砖转 爪转 -Pipeline -转, 专 转转 注驻转  砖砖转 驻拽 **拽转 转专** 驻 住专 转转 拽专.

---
## 3.  砖驻专 Pipeline 住驻

###### Superpipelining
*   转 注拽 -Pipeline (转专 -5 砖). 驻砖专 CCT 拽爪专 转专,   转 -Penalty 砖 Hazards.

###### Dynamic Pipeline Scheduling
*   专 砖 转 住专 爪注 驻拽转 (Out-of-Order Execution)   "注转". 专 .

###### Superscalar
*   爪注 **住驻专 驻拽转 拽**  砖 -Pipeline. 专砖 驻转 专 砖注转转 (住驻专 转 Fetch, Decode, ALU ').