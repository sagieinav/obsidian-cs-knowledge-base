/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var b=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var O=(r,n)=>{for(var e in n)b(r,e,{get:n[e],enumerable:!0})},S=(r,n,e,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of P(n))!k.call(r,a)&&a!==e&&b(r,a,{get:()=>n[a],enumerable:!(s=N(n,a))||s.enumerable});return r};var E=r=>S(b({},"__esModule",{value:!0}),r);var x={};O(x,{default:()=>T});module.exports=E(x);var c=require("obsidian");function w(r,n){let e=Object.keys(n).map(s=>A(r,s,n[s]));return e.length===1?e[0]:function(){e.forEach(s=>s())}}function A(r,n,e){let s=r[n],a=r.hasOwnProperty(n),t=a?s:function(){return Object.getPrototypeOf(r)[n].apply(this,arguments)},i=e(t);return s&&Object.setPrototypeOf(i,s),Object.setPrototypeOf(p,i),r[n]=p,o;function p(...l){return i===t&&r[n]===p&&o(),i.apply(this,l)}function o(){r[n]===p&&(a?r[n]=t:delete r[n]),i!==t&&(i=t,Object.setPrototypeOf(p,s||Function))}}var h=require("obsidian"),L={"after-active":"After active tab","after-pinned":"After pinned tabs",end:"At end"},y={openInNewTab:!0,deduplicateTabs:!0,newTabPlacement:"after-active",openNewTabsInOtherTabGroup:!1},d=class extends h.PluginSettingTab{constructor(n,e){super(n,e),this.plugin=e}display(){this.containerEl.empty(),new h.Setting(this.containerEl).setName("Always open in new tab").setDesc("Open files in a new tab by default.").addToggle(n=>n.setValue(this.plugin.settings.openInNewTab).onChange(async e=>{this.plugin.settings.openInNewTab=e,await this.plugin.saveSettings()})),new h.Setting(this.containerEl).setName("Prevent duplicate tabs").setDesc("If a tab is already open, switch to it instead of re-opening it.").addToggle(n=>n.setValue(this.plugin.settings.deduplicateTabs).onChange(async e=>{this.plugin.settings.deduplicateTabs=e,await this.plugin.saveSettings()})),new h.Setting(this.containerEl).setName("Focus explicit new tabs").setDesc("Immediately switch to new tabs opened via middle or ctrl click instead of opening them in the background. New tabs created by regular click will always focus regardless.").addToggle(n=>n.setValue(this.app.vault.getConfig("focusNewTab")).onChange(async e=>{this.app.vault.setConfig("focusNewTab",e),await this.plugin.saveSettings()})),new h.Setting(this.containerEl).setName("New tab placement").setDesc("Where to place new tabs.").addDropdown(n=>n.addOptions(L).setValue(this.plugin.settings.newTabPlacement).onChange(async e=>{this.plugin.settings.newTabPlacement=e,await this.plugin.saveSettings()})),new h.Setting(this.containerEl).setName("Prefer opening new tabs in other tab group").setDesc("When the workspace is split, open links in the opposite panel.").addToggle(n=>n.setValue(this.plugin.settings.openNewTabsInOtherTabGroup).onChange(async e=>{this.plugin.settings.openNewTabsInOtherTabGroup=e,await this.plugin.saveSettings()}))}};function m(r){return["empty","home-tab-view"].includes(r.view.getViewType())}var W={md:["excalidraw"]},T=class extends c.Plugin{constructor(){super(...arguments);this.settings={...y}}async onload(){await this.loadSettings(),this.addSettingTab(new d(this.app,this));let e=this,s=this.app.workspace.getUnpinnedLeaf;this.register(w(c.Workspace.prototype,{getLeaf(a){return function(t,...i){let p=e.settings.openInNewTab&&!t;t==!0?t="tab":e.settings.openInNewTab?t=t||"tab":t=t||"same";let o;return t=="tab"?(o=e.getNewLeaf(),(e.app.vault.getConfig("focusNewTab")||p)&&e.app.workspace.setActiveLeaf(o)):t=="same"?e.settings.openInNewTab&&s?o=s.call(this):o=a.call(this,!1,...i):o=a.call(this,t,...i),o.openTabSettingsLastOpenType=t,o}},getUnpinnedLeaf(a){return function(...t){return e.settings.openInNewTab?e.app.workspace.getLeaf("tab"):a.call(this,...t)}}})),this.register(w(c.WorkspaceLeaf.prototype,{openFile(a){return async function(t,i,...p){var u;let o=m(this),l=o&&(!this.openTabSettingsLastOpenType||!["same","tab"].includes(this.openTabSettingsLastOpenType));if(e.settings.deduplicateTabs&&!l){let g=await e.findMatchingLeaves(t);if(!g.includes(this)&&g.length>0){let f=(u=e.app.workspace.getActiveViewOfType(c.View))==null?void 0:u.leaf,v=await a.call(g[0],t,{...i,active:!!(i!=null&&i.active)||f==this},...p);return o&&this.parent.children.length>1&&this.detach(),v}}return a.call(this,t,i,...p)}}})),this.registerEvent(this.app.workspace.on("file-menu",(a,t,i,p)=>{t instanceof c.TFile&&a.addItem(o=>{o.setSection("open"),o.setIcon("file-minus"),o.setTitle("Open in same tab"),o.onClick(async()=>{await this.app.workspace.getLeaf("same").openFile(t)})})}))}async loadSettings(){var s;let e=(s=await this.loadData())!=null?s:{};this.settings=Object.assign({},y,e),Object.keys(e).length==0&&(this.app.vault.setConfig("focusNewTab",!1),await this.saveSettings())}async saveSettings(){await this.saveData(this.settings)}async findMatchingLeaves(e){let s=[];return this.app.workspace.iterateAllLeaves(a=>{var u,g,f;let t=a.getRoot(),i=t instanceof c.WorkspaceRoot||t instanceof c.WorkspaceFloating,p=((g=(u=a.getViewState())==null?void 0:u.state)==null?void 0:g.file)==e.path,o=a.view.getViewType(),l=this.app.viewRegistry.getTypeByExtension(e.extension)==o||((f=W[e.extension])==null?void 0:f.includes(o));i&&p&&l&&s.push(a)}),s}getAllTabGroups(e){let s=new Set;this.app.workspace.iterateAllLeaves(t=>{t.getRoot()==e&&s.add(t.parent)});let a=t=>Math.max(...t.children.map(i=>{var p;return(p=i.activeTime)!=null?p:0}));return[...s].sort((t,i)=>a(t)-a(i))}getNewLeaf(){let e=this.app.workspace.getMostRecentLeaf();if(!e)throw new Error("No tab group found.");let s=e.parent,a=s.children.indexOf(e);if(m(e))return e;let t,i=0;if(this.settings.openNewTabsInOtherTabGroup&&!c.Platform.isPhone){let l=this.getAllTabGroups(e.getRoot()).filter(u=>u!==s).at(-1);l&&(t=l,i=l.children.length)}if(!t&&this.settings.newTabPlacement=="after-pinned"&&e.pinned){t=s;let l=t.children.findIndex((u,g)=>!u.pinned&&g>a);i=l<0?t.children.length:l}!t&&this.settings.newTabPlacement=="end"&&(t=s,i=s.children.length),t||(t=s,i=a+1);let p,o=t.children[Math.min(i,t.children.length-1)];return m(o)?p=o:(p=new c.WorkspaceLeaf(this.app),t.insertChild(i,p)),p}};

/* nosourcemap */